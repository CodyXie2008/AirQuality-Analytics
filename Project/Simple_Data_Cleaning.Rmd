---
title: "PMæ•°æ®æ¸…æ´—"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# æ£€æŸ¥å¹¶å®‰è£…å¿…è¦çš„åŒ…ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
required_packages <- c("dplyr", "ggplot2")

for (pkg in required_packages) {
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg)
    library(pkg, character.only = TRUE)
  }
}
```

# PM2.5å’ŒPM10æ•°æ®æ¸…æ´—

## 1. åŠ è½½æ•°æ®

```{r load_data}
# è¯»å–åŸå§‹æ•°æ®
project <- read.csv("air_quality_database.csv")

# æŸ¥çœ‹åŸå§‹æ•°æ®ä¿¡æ¯
cat("åŸå§‹æ•°æ®è¡Œæ•°:", nrow(project), "\n")
cat("åŸå§‹æ•°æ®åˆ—æ•°:", ncol(project), "\n")
cat("PM2.5ç¼ºå¤±å€¼æ•°é‡:", sum(is.na(project$pm25_concentration)), "\n")
cat("PM10ç¼ºå¤±å€¼æ•°é‡:", sum(is.na(project$pm10_concentration)), "\n")
```

## 2. æ•°æ®æ¸…æ´—

```{r clean_data}
# ç§»é™¤PM2.5å’ŒPM10åˆ—ä¸­çš„NAå€¼
cleaned_data <- project[!is.na(project$pm25_concentration) & !is.na(project$pm10_concentration), ]

# æŸ¥çœ‹æ¸…æ´—åæ•°æ®ä¿¡æ¯
cat("æ¸…æ´—åæ•°æ®è¡Œæ•°:", nrow(cleaned_data), "\n")
cat("ç§»é™¤çš„è¡Œæ•°:", nrow(project) - nrow(cleaned_data), "\n")
cat("PM2.5ç¼ºå¤±å€¼æ•°é‡:", sum(is.na(cleaned_data$pm25_concentration)), "\n")
cat("PM10ç¼ºå¤±å€¼æ•°é‡:", sum(is.na(cleaned_data$pm10_concentration)), "\n")
```

## 3. ä¿å­˜æ¸…æ´—åçš„æ•°æ®

```{r save_data}
# ä¿å­˜æ¸…æ´—åçš„æ•°æ®ä¸ºCSVæ–‡ä»¶
write.csv(cleaned_data, "air_quality_cleaned_pm.csv", row.names = FALSE)

# éªŒè¯ä¿å­˜ç»“æœ
if (file.exists("air_quality_cleaned_pm.csv")) {
  # é‡æ–°è¯»å–ä¿å­˜çš„æ–‡ä»¶è¿›è¡ŒéªŒè¯
  saved_data <- read.csv("air_quality_cleaned_pm.csv")
  
  cat("âœ… æ¸…æ´—åçš„æ•°æ®å·²æˆåŠŸä¿å­˜ä¸ºCSVæ–‡ä»¶: air_quality_cleaned_pm.csv\n")
  cat("ğŸ“Š æ–‡ä»¶åŒ…å«", nrow(saved_data), "è¡Œæœ‰æ•ˆæ•°æ®\n")
  cat("ğŸ“ æ–‡ä»¶å¤§å°:", round(file.info("air_quality_cleaned_pm.csv")$size / 1024, 2), "KB\n")
  cat("âœ… æ–‡ä»¶éªŒè¯: PM2.5ç¼ºå¤±å€¼æ•°é‡:", sum(is.na(saved_data$pm25_concentration)), "\n")
  cat("âœ… æ–‡ä»¶éªŒè¯: PM10ç¼ºå¤±å€¼æ•°é‡:", sum(is.na(saved_data$pm10_concentration)), "\n")
} else {
  cat("âŒ CSVæ–‡ä»¶ä¿å­˜å¤±è´¥!\n")
}
```

```{r save_backup}
# å¯é€‰ï¼šä¿å­˜ä¸ºå¤‡ä»½æ–‡ä»¶ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
backup_filename <- paste0("air_quality_cleaned_pm_", format(Sys.time(), "%Y%m%d_%H%M%S"), ".csv")
write.csv(cleaned_data, backup_filename, row.names = FALSE)

if (file.exists(backup_filename)) {
  cat("ğŸ“‚ å¤‡ä»½æ–‡ä»¶å·²ä¿å­˜:", backup_filename, "\n")
}
```

## 4. æ¸…æ´—ç»“æœç»Ÿè®¡

```{r summary}
# åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
cat("## æ¸…æ´—ç»“æœç»Ÿè®¡\n")
cat("PM2.5æµ“åº¦èŒƒå›´:", range(cleaned_data$pm25_concentration), "\n")
cat("PM2.5å¹³å‡å€¼:", mean(cleaned_data$pm25_concentration), "\n")
cat("PM10æµ“åº¦èŒƒå›´:", range(cleaned_data$pm10_concentration), "\n")
cat("PM10å¹³å‡å€¼:", mean(cleaned_data$pm10_concentration), "\n")

# å›½å®¶åˆ†å¸ƒ
cat("\nåŒ…å«å›½å®¶æ•°é‡:", length(unique(cleaned_data$country_name)), "\n")
cat("æ•°æ®å¹´ä»½èŒƒå›´:", range(cleaned_data$year), "\n")
```

## 5. æ•°æ®é¢„è§ˆ

```{r preview}
# æŸ¥çœ‹æ¸…æ´—åæ•°æ®çš„å‰å‡ è¡Œ
cat("## æ¸…æ´—åæ•°æ®é¢„è§ˆ\n")
head(cleaned_data)
```

---

